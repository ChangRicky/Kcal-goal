<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸›è„‚ç†±é‡è·Ÿç›®æ¨™è¨­å®š</title>
  <!--
    BeBetter Lite æ¸›è„‚è¨ˆç®—å™¨
    æœ¬é æä¾›ç°¡å–®çš„æ¸›è„‚è©¦ç®—ï¼Œå¹«åŠ©ä½ ç”¨ç§‘å­¸çš„æ•¸å­—äº†è§£è‡ªå·±ã€‚
    é€™æ˜¯ä¸€å€‹ç´”å‰ç«¯çš„ç¯„ä¾‹ï¼Œç„¡éœ€é€£ç¶²ä¹Ÿå¯ä½¿ç”¨ã€‚ç‚ºäº†é©æ‡‰æ‰‹æ©Ÿã€å¹³æ¿èˆ‡æ¡Œé¢ï¼Œæ¡ç”¨å½ˆæ€§å¸ƒå±€ã€‚
    è‰²å½©ä¾†è‡ªå“ç‰Œï¼šæ·±å¢¨ç¶ æ­é…å«©ç¶ èˆ‡é‡‘è‰²ä½œé»ç¶´ã€‚
  -->
  <style>
    :root {
      /*
        ä½¿ç”¨å“ç‰Œæ©˜è‰²ç³»ä½œç‚ºä¸»é¡Œè‰²ï¼Œæå‡è¦–è¦ºä¸€è‡´æ€§èˆ‡é«˜ç´šæ„Ÿã€‚
        safe ç¯„åœè¨­å®šç‚ºæ¸›è„‚ 300~700 kcalã€å¢è‚Œ -300~0 kcalï¼›è² å€¼ä»£è¡¨ç›ˆé¤˜ã€‚
      */
      /*
        æ”¹ç”¨æŸ”å’Œçš„æš–æ©˜èˆ‡ç±³ç™½è‰²èª¿ï¼Œé…åˆå“ç‰Œç²¾ç¥å¸¶å‡ºé«˜ç´šæ„Ÿã€‚
        ä½¿ç”¨ 60-30-10 åŸå‰‡ï¼šèƒŒæ™¯ä½” 60%ï¼Œä¸»è‰² 30%ï¼Œå¼·èª¿è‰² 10%ã€‚
        å¼•ç”¨ NN/g æŒ‡å—æŒ‡å‡ºï¼Œç²¾é¸çš„èª¿è‰²ç›¤å’Œä¸€è‡´çš„æ’ç‰ˆèƒ½æé«˜ç¾æ„Ÿã€715461275291268â€ L51-L53ã€‘ã€‚
      */
      --primary-color: #c45b48; /* æ·±çŠç‘šæ©˜ï¼Œä½œç‚ºæ¨™é¡Œèˆ‡æŒ‰éˆ•é¡è‰² */
      --accent-color: #e17c45; /* æŸ”å’Œæ¡ƒæ©˜ï¼Œç”¨æ–¼æ¬¡è¦æŒ‰éˆ•èˆ‡æ•¸å­—é¡¯ç¤º */
      --highlight-color: #f8c794; /* æ·¡é‡‘æ¡ƒè‰²ï¼Œé»ç¶´å…ƒç´  */
      --background-color: #fffaf5; /* æš–ç±³ç™½èƒŒæ™¯ï¼Œå¢æ·»æº«æš–æ„Ÿ */
      --text-color: #4a2e2b; /* æ·±æ£•ä½œç‚ºä¸»æ–‡å­—è‰²ï¼Œæå‡å¯è®€æ€§ */
      /* å®‰å…¨ç¯„åœè¨­å®šï¼šç¶­æŒä¹‹å‰ 300â€“700 åŠ -300â€“0 å€é–“ä¸è®Š */
      --safe-min-fat: 300;
      --safe-max-fat: 700;
      --safe-min-gain: -300;
      /* æ–°çš„å¢è‚Œæ¨è–¦å€é–“ç‚º +100~+300 kcalï¼ˆæ›ç®—ç‚ºå·®å€¼ -300~-100ï¼‰ */
      --safe-max-gain: -100;
      /* ä½é£½å’Œåº¦å®‰å…¨è‰²ï¼šä½¿ç”¨å“ç‰Œè‰²æ·¡åŒ–ç‰ˆæœ¬ï¼Œé¿å…éæ–¼çªå…€ */
      --safe-color-fat: rgba(243, 137, 103, 0.18); /* æ·ºæ©˜ */
      --safe-color-gain: rgba(130, 192, 162, 0.18); /* æ·ºç¶  */
      /* è¡¨æ ¼æ–‘é¦¬ç´‹é¡è‰²ï¼šæ·¡ç±³ç™½ */
      --table-row-alt: #fdf4f0;
      /* è¡¨é ­åº•è‰²ï¼šæ·¡æè‰² */
      --table-header-bg: #fde4d1;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Inter", "Noto Sans TC", sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.5;
    }
    h1, h2, h3 {
      margin: 0;
      font-weight: 600;
      color: var(--primary-color);
    }
    h1 {
      font-size: 1.6rem;
    }
    h2 {
      font-size: 1.4rem;
      margin-top: 1rem;
      margin-bottom: 0.75rem;
      text-align: center;
    }
    h3 {
      font-size: 1.2rem;
      margin-bottom: .25rem;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    header img {
      height: 48px;
      width: auto;
    }
    header h1 {
      flex: 1;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
      /* å¡ç‰‡æ¨£å¼ï¼šç™½è‰²èƒŒæ™¯ã€åœ“è§’èˆ‡é™°å½±è®“æ¯ä¸€æ­¥æ›´åŠ èšç„¦ */
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      padding: 1.5rem;
      margin-top: 1.5rem;
      width: 100%;
      max-width: 600px;
    }
    .steps-nav {
      display: flex;
      justify-content: space-between;
      /* å†æ‹‰å¤§ä¸Šä¸‹é–“è·èˆ‡æŒ‰éˆ•é–“è·ï¼Œæä¾›æ›´å¤šç©ºé–“æ„Ÿ */
      margin: 2rem 0 3rem 0;
      gap: 1.5rem;
    }
    .steps-nav button {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1.2rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .steps-nav button:hover {
      background-color: var(--accent-color);
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      align-items: center;
    }
    label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      /* ä½¿æ¨™ç±¤å€åŸŸä¿æŒå›ºå®šå¯¬åº¦ä»¥ä¾¿å±…ä¸­ */
      width: 100%;
      max-width: 360px;
      text-align: left;
    }
    input[type="number"], select {
      padding: 0.6rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 0.25rem;
      /* æ§åˆ¶æ¬„ä½å¯¬åº¦ï¼Œæ ¹æ“šçˆ¶å…ƒç´ å¯¬åº¦è‡ªé©æ‡‰ï¼Œä¸¦é™åˆ¶æœ€å¤§å¯¬åº¦ */
      width: 100%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    /* èª¿æ•´æ»‘æ¡¿çš„å¯¬åº¦å¡«æ»¿å®¹å™¨ï¼Œé¿å…å—åˆ°ä¸Šé¢æ¬„ä½å¯¬åº¦é™åˆ¶ */
    input[type="range"] {
      width: 100%;
    }
    .radio-group {
      display: flex;
      /* å°‡æ€§åˆ¥é¸é …é–“è·èª¿æ•´å¾—æ›´ç·Šå¯†ï¼Œé¿å…åˆ†æ•£æ„Ÿ */
      gap: 0.2rem;
    }
    .radio-group label {
      flex-direction: row;
      align-items: center;
      gap: 0.3rem;
      cursor: pointer;
    }
    .activity-cards {
      /* æ”¹ç‚ºç›´å¼æ’åˆ—ï¼Œæé«˜é–±è®€æ€§ */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.2rem;
      margin-top: 1rem;
    }
    .activity-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 0.7rem;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.2s, border-color 0.2s;
      width: 100%;
      max-width: 360px;
    }
    .activity-card.active {
      background-color: var(--accent-color);
      border-color: var(--accent-color);
      color: #fff;
    }
    .bodyfat-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .bodyfat-images {
      /* å‚ç›´æ’åˆ—é«”è„‚åƒè€ƒåœ–ç‰‡ï¼Œé¿å…ä¸¦æ’å¤ªå° */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      padding-bottom: 1rem;
    }
    .bodyfat-images img {
      /* è®“åœ–ç‰‡å¯¬åº¦é©æ‡‰å®¹å™¨ï¼Œé«˜åº¦è‡ªå‹•ï¼Œä»¥ç¶­æŒæ¯”ä¾‹ï¼›ä½¿ç”¨æ›´å¤§å¯¬åº¦é¿å…éå° */
      width: 90%;
      height: auto;
      border-radius: 8px;
      flex-shrink: 0;
    }
    .slider-container {
      margin-top: 1rem;
    }
    input[type="range"] {
      width: 100%;
    }
    .results {
      margin-top: 1rem;
      background-color: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }

    /* å…¨å±€æ­¥é©Ÿæ®µè½æ¨£å¼ï¼šç½®ä¸­ä¸”é™åˆ¶å¯¬åº¦ */
    .step p {
      text-align: center;
      max-width: 600px;
      margin: 0.5rem auto 1rem;
    }
    .results h3 {
      color: var(--primary-color);
      margin-bottom: 0.5rem;
      text-align: center;
    }
    .stat-grid {
      /* ä½¿ç”¨å‚ç›´æ’åˆ—çš„æ ¼å­ï¼Œå…§å«å¤šè¡Œè³‡è¨Šå¡ */
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    /* è‡ªè¨‚ä¸Šæ’èˆ‡ä¸‹æ’å¡ç‰‡çš„å¯¬åº¦ï¼Œé¿å…æ“æ“  */
    .stat-row.top-row .stat-card {
      flex: 1 1 calc(33.333% - 0.67rem);
      min-width: 160px;
    }
    /* ç¬¬äºŒæ’çµ±è¨ˆå¡ç‰‡ï¼šå…è¨±æ›è¡Œï¼Œæ¯åˆ—æœ€å¤š 2 å¼µå¡ç‰‡ï¼Œæä¾›æ›´èˆ’é©çš„ç©ºé–“ */
    .stat-row.bottom-row {
      flex-wrap: wrap;
    }
    .stat-row.bottom-row .stat-card {
      flex: 1 1 calc(50% - 0.75rem);
      min-width: 160px;
    }

    .stat-card {
      flex: 1 1 auto;
      min-width: 140px;
      border: 1px solid var(--table-row-alt);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      background-color: #FFFFFF;
      box-shadow: 0 2px 4px rgba(0,0,0,0.03);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* çªå‡ºé¡¯ç¤ºç›®æ¨™ç†±é‡å¡ç‰‡ï¼šä½¿ç”¨æ·¡è‰²èƒŒæ™¯èˆ‡æ·±è‰²é‚Šæ¡† */
    .highlight-card {
      border: 2px solid var(--accent-color);
      background-color: rgba(226, 140, 108, 0.12);
    }

    .stat-card span {
      display: block;
      font-size: 1.3rem;
      color: var(--accent-color);
      font-weight: 600;
      margin-top: 0.25rem;
    }

    /* å¼·èª¿ç›®æ¨™ç†±é‡æ¨™ç±¤ï¼Œä½¿å…¶æ›´é†’ç›® */
    #targetLabel {
      font-size: 1rem;
      font-weight: 700;
      color: var(--primary-color);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      overflow: hidden;
      border-radius: 6px;
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }
    th, td {
      padding: 0.5rem;
      text-align: center;
      border: none;
    }
    th {
      background-color: var(--table-header-bg);
      color: var(--primary-color);
    }

    /* ç‚ºè¡¨æ ¼æ·»åŠ æ·¡æ·¡çš„åˆ†éš”ç·šï¼Œæå‡è³ªæ„Ÿ */
    #deficitTable tr {
      border-bottom: 1px solid #f2e7e2;
    }
    #deficitTable tr:last-child {
      border-bottom: none;
    }
    .safe {
      background-color: var(--accent-color);
      color: #fff;
    }

    /* ç§»é™¤æ–‘é¦¬ç´‹ï¼Œä»¥ä¿æŒéæ¨è–¦è¡Œç„¡èƒŒæ™¯è‰² */
    #deficitTable tr:nth-child(even):not(.safe-fat):not(.safe-gain) {
      background-color: transparent;
    }

    /* æ–°çš„å®‰å…¨ç¯„åœæ¨£å¼ï¼šä½é£½å’Œåº¦è‰²å½©èˆ‡å‹•æ…‹èƒŒæ™¯ */
    .safe-fat {
      background: var(--safe-color-fat);
      color: var(--text-color);
      animation: safePulse 6s linear infinite;
      font-weight: 600;
    }
    .safe-gain {
      background: var(--safe-color-gain);
      color: var(--text-color);
      animation: safePulse 6s linear infinite;
      font-weight: 600;
    }

    /* æ¼¸è®Šå‹•æ•ˆ */
    @keyframes safePulse {
      0% { background-position: 0 0; }
      100% { background-position: 200% 0; }
    }

    /* æ»‘æ¡¿å®¹å™¨èˆ‡å®‰å…¨å€é¡¯ç¤ºæ¢ */
    .slider-wrapper {
      position: relative;
    }
    #safeBar {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      height: 8px;
      border-radius: 4px;
      z-index: 0;
      left: 0;
      width: 0;
      /* é¡è‰²èˆ‡å‹•ç•«æœƒåœ¨ JS ä¸­è¨­å®š */
      pointer-events: none;
    }
    #deficitRange {
      position: relative;
      z-index: 1;
    }

    /* æ¯æ—¥å·®å€¼æ¨™ç±¤èˆ‡æ•¸å€¼ï¼šæ°´å¹³æ’åˆ—ä¸¦åŠ ä¸Šå‹•æ…‹æ•ˆæœ */
    .deficit-label {
      display: flex;
      align-items: baseline;
      justify-content: center;
      gap: 0.4rem;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    #deficitValue {
      font-weight: 700;
      transition: color 0.2s, transform 0.2s;
    }
    /* å‹•æ…‹å‹•ç•«ï¼šæ‹‰æ¡¿ç§»å‹•æ™‚æ•¸å€¼æ”¾å¤§å¾Œå›å½ˆ */
    @keyframes valuePulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    /* å®‰å…¨ç¯„åœæ–‡å­— */
    .safe-range-text {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--primary-color);
      display: inline-block;
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      background-color: rgba(235,124,94,0.1);
    }

    /* CTA æŒ‰éˆ•è‡ªå®šç¾©å¤–è§€ */
    .cta-btn {
      background: linear-gradient(45deg, var(--accent-color), var(--highlight-color));
      border: none;
      color: #fff;
      padding: 0.7rem 1.4rem;
      border-radius: 20px;
      text-decoration: none;
      display: inline-block;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .cta-btn:hover {
      transform: scale(1.05);
    }
    .download-btn, .cta-btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.6rem 1.4rem;
      border-radius: 8px;
      text-decoration: none;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s;
    }
    /* ä¸‹è¼‰æŒ‰éˆ•ä½¿ç”¨ä¸»è‰²ï¼Œæ»‘éæ™‚ä½¿ç”¨äº®ç¶ è‰² */
    .download-btn {
      background-color: var(--primary-color);
      color: #ffffff;
    }
    .download-btn:hover {
      background-color: var(--accent-color);
    }
    /* CTA æŒ‰éˆ•ä½¿ç”¨äº®ç¶ è‰²ï¼Œæ»‘éæ™‚è®Šç‚ºçŠç‘šè‰² */
    .cta-btn {
      background-color: var(--accent-color);
      color: #ffffff;
    }
    .cta-btn:hover {
      background-color: var(--highlight-color);
    }

    /* Step5 è¡Œå‹•å€å¡Šï¼šä¸¦æ’æˆ–æ›è¡Œæ’åˆ—å…©å€‹æŒ‰éˆ• */
    .result-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }

    /* Step5 ä¸‹è¼‰èˆ‡è«®è©¢å€å¡Šæ¨£å¼ */
    .download-section, .consult-section {
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 1.5rem;
      margin: 1rem 0;
      text-align: center;
    }
    .download-section h3, .consult-section h3 {
      color: var(--primary-color);
      font-size: 1.3rem;
      margin-top: 0;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    .download-section p, .consult-section p {
      color: var(--text-color);
      font-size: 0.9rem;
      margin-bottom: 1rem;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }
    @media (min-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      h2 {
        font-size: 1.6rem;
      }
    }

    /* æ»‘é¼ è·Ÿéš¨çš„åœ“åœˆ */
    .cursor-circle {
      position: fixed;
      top: 0;
      left: 0;
      /* å°‡æ»‘é¼ ç‰¹æ•ˆæ”¹ç‚ºç©ºå¿ƒåœ“ç’°åŒ…è¦†åœ¨æŒ‡é‡å¤–ç·£ï¼Œä¸é®æ“‹å…§å®¹ */
      width: 60px;
      height: 60px;
      border-radius: 50%;
      pointer-events: none;
      border: 2px solid var(--accent-color);
      /* ç„¡èƒŒæ™¯å¡«è‰²ï¼Œåªç•™ä¸‹åœ“ç’°ï¼Œä¸¦åŠ ä¸ŠæŸ”å’Œé™°å½± */
      background: transparent;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.05);
      transition: transform 0.08s linear;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <!-- æ»‘é¼ è·Ÿéš¨åœ“åœˆï¼šæå‡äº’å‹•æ„Ÿ -->
  <div class="cursor-circle" id="cursorCircle"></div>
  <div class="container">
    <header>
      <!-- logo å·²ç§»é™¤ï¼Œå¦‚éœ€æ”¾ç½®å“ç‰Œåœ–å¯åœ¨æ­¤è™•åŠ å…¥ <img> -->
      <h1>æ¸›è„‚ç†±é‡è·Ÿç›®æ¨™è¨­å®š</h1>
    </header>

    <!-- Step navigation (progress indicator hidden initially) -->
    <div class="steps-nav">
      <button id="prevBtn" onclick="prevStep()" disabled>ä¸Šä¸€æ­¥</button>
      <button id="nextBtn" onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
    </div>

    <!-- Step 1: åŸºæœ¬è³‡æ–™ -->
    <section id="step1" class="step active">
      <h2>åŸºæœ¬è³‡æ–™</h2>
      <form id="form1">
        <label>æ€§åˆ¥
          <div class="radio-group">
            <label><input type="radio" name="sex" value="male" checked> ç”·</label>
            <label><input type="radio" name="sex" value="female"> å¥³</label>
          </div>
        </label>
        <label>å¹´é½¡ (æ­²)
          <input type="number" name="age" min="15" max="75" value="25" required>
        </label>
        <label>èº«é«˜ (cm)
          <input type="number" name="height" min="130" max="210" value="170" required>
        </label>
        <label>é«”é‡ (kg)
          <input type="number" name="weight" min="35" max="200" value="65" required>
        </label>
      </form>
    </section>

    <!-- Step 2: æ´»å‹•é‡ -->
    <section id="step2" class="step">
      <h2>æ´»å‹•é‡</h2>
      <p>è«‹é¸æ“‡ä½ éå»å…©é€±æœ€å¸¸è¦‹çš„æ´»å‹•é‡</p>
      <div class="activity-cards" id="activityCards">
        <div class="activity-card" data-value="1.2">
          <h3>ä¹…å</h3>
          <p>å¹¾ä¹ä¸é‹å‹•</p>
        </div>
        <div class="activity-card" data-value="1.375">
          <h3>è¼•é‡</h3>
          <p>æ¯é€± 1â€“3 æ¬¡é‹å‹•</p>
        </div>
        <div class="activity-card" data-value="1.55">
          <h3>ä¸­ç­‰</h3>
          <p>æ¯é€± 3â€“5 æ¬¡é‹å‹•</p>
        </div>
        <div class="activity-card" data-value="1.725">
          <h3>é«˜é‡</h3>
          <p>æ¯é€± 6â€“7 æ¬¡é‹å‹•</p>
        </div>
        <div class="activity-card" data-value="1.9">
          <h3>é‹å‹•å“¡</h3>
          <p>é«”åŠ›å‹å‹•æˆ–è¨“ç·´è€…</p>
        </div>
      </div>
    </section>

    <!-- Step 3: é«”å‹èˆ‡ç›®æ¨™ -->
    <section id="step3" class="step">
      <h2>é«”å‹èˆ‡ç›®æ¨™</h2>
      <p>é¸æ“‡ä½ çš„é«”å‹ï¼ˆé«”è„‚ç­‰ç´šï¼‰èˆ‡ç›®æ¨™æ–¹å‘</p>
      <div class="bodyfat-container">
        <!-- æä¾›ç”·æ€§èˆ‡å¥³æ€§é«”è„‚åƒè€ƒåœ–ç‰‡ã€‚è«‹å°‡æª”æ¡ˆ male_bodyfat.png èˆ‡ female_bodyfat.png æ”¾å…¥èˆ‡æ­¤ HTML åŒå±¤çš„ images ç›®éŒ„ä¸­ã€‚ -->
        <div class="bodyfat-images">
          <img src="images/male_bodyfat.png" alt="ç”·æ€§é«”è„‚åƒè€ƒ">
          <img src="images/female_bodyfat.png" alt="å¥³æ€§é«”è„‚åƒè€ƒ">
        </div>
        <label>ç¾åœ¨é«”æ…‹ï¼ˆä¸Šåœ–åƒè€ƒï¼‰
          <select id="bodyFatSelect">
            <!-- äº”ç´šé«”å‹åˆ†é¡ï¼Œä¸¦é™„ç”·å¥³é«”è„‚å€é–“èªªæ˜ -->
            <option value="athlete">é‹å‹•å“¡ (ç”·æ€§6â€“13%, å¥³æ€§14â€“20%)</option>
            <option value="lean">ç²¾å¯¦ (ç”·æ€§14â€“17%, å¥³æ€§21â€“24%)</option>
            <option value="standard" selected>æ¨™æº– (ç”·æ€§18â€“24%, å¥³æ€§25â€“31%)</option>
            <option value="over">éé«˜ (ç”·æ€§25â€“29%, å¥³æ€§32â€“37%)</option>
            <option value="obese">è‚¥èƒ– (ç”·æ€§â‰¥30%, å¥³æ€§â‰¥38%)</option>
          </select>
        </label>
        <label>ç›®æ¨™æ–¹å‘
          <div class="radio-group">
            <label><input type="radio" name="goal" value="fat_loss" checked> æ¸›è„‚</label>
            <label><input type="radio" name="goal" value="maintain"> ç¶­æŒ</label>
            <label><input type="radio" name="goal" value="gain"> å¢è‚Œ</label>
          </div>
        </label>
        <label>ç›®æ¨™é«”é‡ (kg)
          <input type="number" id="targetWeight" min="30" max="200" value="60" required>
        </label>
      </div>
    </section>

    <!-- Step 4: ç†±é‡èµ¤å­—èˆ‡çµæœ -->
    <section id="step4" class="step">
      <h2>ç†±é‡èµ¤å­— / ç›ˆé¤˜è¨­å®š</h2>
      <p>æ‹–æ›³æ»‘æ¡¿èª¿æ•´æ¯æ—¥ç†±é‡å·®å€¼ï¼Œè² å€¼ä»£è¡¨ç›ˆé¤˜ï¼ˆå¢è‚Œï¼‰ï¼Œæ­£å€¼ä»£è¡¨èµ¤å­—ï¼ˆæ¸›è„‚ï¼‰ã€‚å»ºè­°æ¸›è„‚å®‰å…¨å€é–“ï¼š300â€“700 kcalï¼›å¢è‚Œå®‰å…¨å€é–“ï¼š0â€“300 kcalã€‚</p>
      <div class="slider-container">
        <div class="slider-wrapper">
          <div id="safeBar"></div>
          <!-- å°‡æ¨™ç±¤èˆ‡æ•¸å€¼åŒ…æˆä¸€è¡Œï¼Œæ–¹ä¾¿å‹•æ…‹æ›´æ–°é¡è‰²èˆ‡å‹•ç•« -->
          <div class="deficit-label">
            <span>æ¯æ—¥ç†±é‡å·®å€¼ (kcal)ï¼š</span>
            <span id="deficitValue">150</span>
          </div>
          <input type="range" id="deficitRange" min="-500" max="1000" step="50" value="150">
        </div>
        <p id="safeRangeText" class="safe-range-text"></p>
      </div>
      <div class="results" id="results">
        <h3>è¨ˆç®—çµæœ</h3>
        <div class="stat-grid">
          <!-- ç¬¬ä¸€è¡Œï¼šBMRã€å»ºè­°ç†±é‡ï¼ˆå‡¸é¡¯ï¼‰ã€TDEE -->
          <div class="stat-row top-row">
            <div class="stat-card">
              BMR<br><span id="bmr">--</span> kcal/æ—¥
            </div>
            <div class="stat-card highlight-card" id="targetCard">
              <span id="targetLabel">æ¸›è„‚ç†±é‡</span><br><span id="targetKcal">--</span> kcal/æ—¥
            </div>
            <div class="stat-card">
              TDEE<br><span id="tdee">--</span> kcal/æ—¥
            </div>
          </div>
          <!-- ç¬¬äºŒè¡Œï¼šåˆ†åˆ¥é¡¯ç¤ºæ¯é€±è®ŠåŒ–ã€æ¯æœˆè®ŠåŒ–ã€é”æˆé€±æ•¸ã€é”æˆæœˆæ•¸ï¼Œé¿å…è³‡è¨Šæ“æ“  -->
          <div class="stat-row bottom-row">
            <div class="stat-card">
              æ¯é€±è®ŠåŒ–<br><span id="weeklyLoss">--</span> kg
            </div>
            <div class="stat-card">
              æ¯æœˆè®ŠåŒ–<br><span id="monthlyLoss">--</span> kg
            </div>
            <div class="stat-card">
              é”æˆé€±æ•¸<br><span id="weeks">--</span> é€±
            </div>
            <div class="stat-card">
              é”æˆæœˆæ•¸<br><span id="months">--</span> æœˆ
            </div>
          </div>
        </div>
        <h3>èµ¤å­— / ç›ˆé¤˜å°ç…§è¡¨</h3>
        <table>
          <thead>
            <tr>
              <th>æ¯æ—¥å·®å€¼ (kcal)</th>
              <th>æ¯é€±è®ŠåŒ– (kg)</th>
              <th>æ¯æœˆè®ŠåŒ– (kg)</th>
            </tr>
          </thead>
          <tbody id="deficitTable">
            <!-- rows inserted by JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Step 5: çµæœèˆ‡ä¸‹ä¸€æ­¥ -->
    <section id="step5" class="step">
      <h2>æˆæœèˆ‡ä¸‹ä¸€æ­¥</h2>
      <!-- å¼·èª¿ä¸‹è¼‰çµæœå¡ï¼šæ”¾ç½®æ–¼æœ€ä¸Šæ–¹ï¼Œé¼“å‹µåˆ†äº«èˆ‡ç´€éŒ„ -->
      <div class="download-section">
        <h3>ä¸‹è¼‰çµæœå¡</h3>
        <p>ç«‹å³ä¸‹è¼‰ä½ çš„å°ˆå±¬çµæœå¡ï¼Œè¨˜éŒ„ BMRã€TDEEã€å»ºè­°ç†±é‡åŠé ä¼°è®ŠåŒ–ï¼Œä¸¦åˆ†äº«åˆ°ç¤¾ç¾¤èˆ‡å¥½å‹ï¼Œé¼“å‹µè‡ªå·±æŒçºŒå‰é€²ï¼</p>
        <a href="#" id="downloadCardBtn" class="download-btn">ä¸‹è¼‰çµæœå¡</a>
      </div>
      <!-- ä¸€å°ä¸€ç‡Ÿé¤Šè«®è©¢ï¼šæ”¾ç½®æ–¼ç¬¬äºŒå€å¡Šï¼Œæä¾›å°ˆæ¥­å”åŠ© -->
      <div class="consult-section">
        <h3>ä¸€å°ä¸€ç‡Ÿé¤Šè«®è©¢</h3>
        <p>æƒ³åŠ é€Ÿç›®æ¨™é”æˆï¼Ÿç«‹å³é ç´„ä¸€å°ä¸€ç‡Ÿé¤Šè«®è©¢ï¼Œç”±å°ˆæ¥­ç‡Ÿé¤Šå¸«ç‚ºä½ é‡èº«è¦åŠƒé¤é£Ÿèˆ‡é‹å‹•ï¼Œé™ªä¼´ä½ å¥åº·å‰è¡Œã€‚</p>
        <a href="#" id="consultBtn" class="cta-btn">é ç´„ä¸€å°ä¸€è«®è©¢</a>
      </div>
    </section>
  </div>

  <script>
    // å…¨å±€ç‹€æ…‹
    let currentStep = 1;
    let selectedActivity = null;

    // é«”è„‚åƒè€ƒæŒ‰éˆ•æ·»åŠ äº‹ä»¶
    document.querySelectorAll('.activity-card').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.activity-card').forEach(c => c.classList.remove('active'));
        card.classList.add('active');
        selectedActivity = parseFloat(card.dataset.value);
      });
    });

    // å•Ÿå‹• slider äº‹ä»¶
    const deficitRange = document.getElementById('deficitRange');
    const deficitValueEl = document.getElementById('deficitValue');
    deficitRange.addEventListener('input', () => {
      // æ›´æ–°é¡¯ç¤ºå€¼
      const rawVal = parseFloat(deficitRange.value);
      // æ ¼å¼åŒ–é¡¯ç¤ºï¼šæ­£å€¼é¡¯ç¤ºç‚º -Xï¼ˆèµ¤å­—ï¼‰ï¼Œè² å€¼é¡¯ç¤ºç‚º +Xï¼ˆç›ˆé¤˜ï¼‰
      let displayVal = '';
      if (rawVal > 0) {
        displayVal = '-' + rawVal;
      } else if (rawVal < 0) {
        displayVal = '+' + Math.abs(rawVal);
      } else {
        displayVal = '0';
      }
      deficitValueEl.textContent = displayVal;
      // æ ¹æ“šæ­£è² è¨­å®šé¡è‰²ï¼šèµ¤å­—ç‚ºçŠç‘šè‰²ï¼Œç›ˆé¤˜ç‚ºç¶ è‰²
      if (rawVal >= 0) {
        deficitValueEl.style.color = 'var(--accent-color)';
      } else {
        deficitValueEl.style.color = '#5a8f78';
      }
      // åŠ å…¥å‹•ç•«æ•ˆæœï¼šæ¯æ¬¡å€¼è®Šæ›´æ™‚ç¸®æ”¾å›å½ˆ
      deficitValueEl.style.animation = 'valuePulse 0.4s ease';
      setTimeout(() => {
        deficitValueEl.style.animation = '';
      }, 400);
      if(currentStep >= 4) computeResults();
    });

    // ä¸‹ä¸€æ­¥èˆ‡ä¸Šä¸€æ­¥
    function showStep() {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      document.getElementById('step' + currentStep).classList.add('active');
      // æ§åˆ¶æŒ‰éˆ•
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      prevBtn.disabled = currentStep === 1;
      if (currentStep === 4) {
        nextBtn.textContent = 'å®Œæˆ';
        // When displaying step 4, recompute results so all values reflect the current slider and inputs
        computeResults();
      } else if (currentStep === 5) {
        nextBtn.style.display = 'none';
        prevBtn.style.display = 'none';
        // åœ¨é¡¯ç¤ºçµæœé æ™‚ç”¢ç”Ÿçµæœå¡
        generateResultCard();
      } else {
        nextBtn.textContent = 'ä¸‹ä¸€æ­¥';
        nextBtn.style.display = '';
        prevBtn.style.display = '';
      }
    }
    function nextStep() {
      if (currentStep === 1) {
        // æª¢æŸ¥è³‡æ–™
        const form = document.getElementById('form1');
        if(!form.checkValidity()) {
          form.reportValidity();
          return;
        }
      }
      if (currentStep === 2 && !selectedActivity) {
        alert('è«‹é¸æ“‡æ´»å‹•é‡ã€‚');
        return;
      }
      if (currentStep === 3) {
        // è¨­å®šé è¨­èµ¤å­—é¡¯ç¤º
        computeResults();
      }
      currentStep++;
      if (currentStep > 5) currentStep = 5;
      showStep();
    }
    function prevStep() {
      currentStep--;
      if (currentStep < 1) currentStep = 1;
      showStep();
    }
    showStep();

    // å…¨å±€å­˜å„²è¨ˆç®—çµæœï¼Œç”¨æ–¼ç”¢ç”Ÿçµæœå¡
    let computedResults = {};

    // è¨ˆç®—çµæœå‡½å¼
    function computeResults() {
      const sex = document.querySelector('input[name="sex"]:checked').value;
      const age = parseFloat(document.querySelector('input[name="age"]').value);
      const height = parseFloat(document.querySelector('input[name="height"]').value);
      const weight = parseFloat(document.querySelector('input[name="weight"]').value);
      const goalType = document.querySelector('input[name="goal"]:checked').value;
      const targetWeight = parseFloat(document.getElementById('targetWeight').value);
      // åŸºç¤ä»£è¬
      let bmr;
      if (sex === 'male') {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }
      // æ´»å‹•é‡
      const activity = selectedActivity || 1.2;
      const tdee = bmr * activity;
      // ç†±é‡å·®å€¼ (æ­£å€¼ç‚ºèµ¤å­—ï¼Œè² å€¼ç‚ºç›ˆé¤˜)
      const diffVal = parseFloat(deficitRange.value);
      let usedDeficit = 0;
      let usedSurplus = 0;
      if (goalType === 'fat_loss') {
        usedDeficit = Math.max(0, diffVal);
      } else if (goalType === 'gain') {
        usedSurplus = Math.max(0, -diffVal);
      }
      // ç›®æ¨™ç†±é‡
      let targetKcal = tdee - usedDeficit + usedSurplus;
      // æ¸›è„‚è­·æ¬„ï¼šé¿å…ç†±é‡éä½
      const minKcal = (sex === 'male') ? Math.max(1500, bmr * 1.1) : Math.max(1200, bmr * 1.1);
      if (goalType === 'fat_loss' && targetKcal < minKcal) {
        targetKcal = minKcal;
      }
      // æ¯é€±èˆ‡æ¯æœˆè®ŠåŒ–
      const weeklyChangeVal = ((usedDeficit + usedSurplus) * 7) / 7700;
      const monthlyChangeVal = weeklyChangeVal * 4;
      // é€±æœŸï¼ˆé€±ï¼‰èˆ‡æœˆæ•¸
      let weeks = '--';
      let monthsToReach = '--';
      if (goalType === 'fat_loss' && weeklyChangeVal > 0) {
        const gap = weight - targetWeight;
        if (gap > 0) {
          weeks = (gap / weeklyChangeVal).toFixed(1);
          monthsToReach = (weeks / 4).toFixed(1);
        } else {
          weeks = 0;
          monthsToReach = 0;
        }
      } else if (goalType === 'gain' && weeklyChangeVal > 0) {
        const gap = targetWeight - weight;
        if (gap > 0) {
          weeks = (gap / weeklyChangeVal).toFixed(1);
          monthsToReach = (weeks / 4).toFixed(1);
        } else {
          weeks = 0;
          monthsToReach = 0;
        }
      } else if (goalType === 'maintain') {
        weeks = 0;
        monthsToReach = 0;
      }
      // æ›´æ–°ä»‹é¢
      document.getElementById('bmr').textContent = Math.round(bmr);
      document.getElementById('tdee').textContent = Math.round(tdee);
      document.getElementById('targetKcal').textContent = Math.round(targetKcal);
      // é€±è®ŠåŒ–é¡¯ç¤ºå¸¶ç¬¦è™Ÿï¼šèµ¤å­— (diff >= 0) ç‚ºè² ï¼Œç›ˆé¤˜ (diff < 0) ç‚ºæ­£
      const sign = diffVal >= 0 ? '-' : '+';
      const weeklyDisplay = Math.abs(weeklyChangeVal).toFixed(2);
      const monthlyDisplay = Math.abs(monthlyChangeVal).toFixed(2);
      document.getElementById('weeklyLoss').textContent = sign + weeklyDisplay;
      document.getElementById('monthlyLoss').textContent = sign + monthlyDisplay;
      document.getElementById('weeks').textContent = weeks;
      document.getElementById('months').textContent = monthsToReach;
      // æ›´æ–°èµ¤å­—/ç›ˆé¤˜å°ç…§è¡¨
      populateDeficitTable();
      // æ›´æ–°å®‰å…¨ç¯„åœæ¢åŠæ–‡å­—
      updateSafeBar(goalType);
      // æ ¹æ“šç›®æ¨™é¡å‹æ›´æ–°æ¨™ç±¤æ–‡å­—
      const targetLabelEl = document.getElementById('targetLabel');
      if (goalType === 'gain') {
        targetLabelEl.textContent = 'å¢è‚Œç†±é‡';
      } else if (goalType === 'maintain') {
        targetLabelEl.textContent = 'ç¶­æŒç†±é‡';
      } else {
        targetLabelEl.textContent = 'æ¸›è„‚ç†±é‡';
      }
      // å„²å­˜çµæœæ–¼å…¨å±€å°è±¡
      computedResults = {
        bmr,
        tdee,
        targetKcal,
        diffVal,
        usedDeficit,
        usedSurplus,
        weeklyChangeVal,
        monthlyChangeVal,
        weeks,
        monthsToReach,
        goalType,
        weight,
        targetWeight
      };
    }

    // å»ºç«‹èµ¤å­—è¡¨æ ¼
    function populateDeficitTable() {
      const tbody = document.getElementById('deficitTable');
      tbody.innerHTML = '';
      const deficits = [100,200,300,400,500,600,700,800,900,1000];
      deficits.forEach(d => {
        const weekly = (d * 7 / 7700).toFixed(2);
        const monthly = (weekly * 4).toFixed(1);
        const tr = document.createElement('tr');
        if (d >= 500 && d <= 700) {
          tr.classList.add('safe');
        }
        tr.innerHTML = `\n+          <td>${d}</td>\n+          <td>${weekly}</td>\n+          <td>${monthly}</td>`;
        tbody.appendChild(tr);
      });
    }

    // ç”Ÿæˆè©¦è·‘è¡¨ CSV
    function updateTrialPlan() {
      const sex = document.querySelector('input[name="sex"]:checked').value;
      const age = parseFloat(document.querySelector('input[name="age"]').value);
      const height = parseFloat(document.querySelector('input[name="height"]').value);
      const weight = parseFloat(document.querySelector('input[name="weight"]').value);
      const goalType = document.querySelector('input[name="goal"]:checked').value;
      const deficit = parseFloat(deficitRange.value);
      // é‡æ–°è¨ˆç®— BMR & TDEE & å»ºè­°ç†±é‡
      let bmr;
      if (sex === 'male') {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }
      const activity = selectedActivity || 1.2;
      const tdee = bmr * activity;
      let targetKcal;
      if (goalType === 'fat_loss') {
        targetKcal = tdee - deficit;
      } else if (goalType === 'maintain') {
        targetKcal = tdee;
      } else {
        targetKcal = tdee + 300;
      }
      const csvRows = [];
      csvRows.push('æ—¥æœŸ,é è¨ˆæ”å–ç†±é‡ (kcal),å¯¦éš›æ”å– (kcal),å·®è· (kcal)');
      for (let i = 1; i <= 30; i++) {
        const date = `Day ${i}`;
        csvRows.push(`${date},${Math.round(targetKcal)},,`);
      }
      const csvContent = csvRows.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const downloadLink = document.getElementById('downloadLink');
      downloadLink.href = url;
      downloadLink.download = 'trial_plan.csv';
    }

    // åˆå§‹åŒ–èµ¤å­—è¡¨æ ¼
    populateDeficitTable();

    /*
      é‡å¯« populateDeficitTable ä»¥æ”¯æ´èµ¤å­—èˆ‡ç›ˆé¤˜å…©ç¨®å®‰å…¨å€åŸŸæ¨™ç¤ºã€‚
      æ­¤å‡½å¼å°‡ç”¢ç”Ÿ -500 è‡³ 1000 çš„å°ç…§è¡¨ï¼Œä¸¦ä»¥å®‰å…¨è‰²æ¨™ç¤ºæ¸›è„‚ (300~700) èˆ‡å¢è‚Œ (-300~0)ã€‚
    */
    populateDeficitTable = function() {
      const tbody = document.getElementById('deficitTable');
      tbody.innerHTML = '';
      const values = [];
      // å…¨ç¯„åœé¡¯ç¤ºï¼šå¾ -500 åˆ° 1000ï¼Œæ¯ 100 ç‚ºä¸€æ ¼ï¼Œè·³é 0
      for (let v = -500; v <= 1000; v += 100) {
        if (v === 0) continue;
        values.push(v);
      }
      values.forEach(val => {
        const weekly = ((Math.abs(val) * 7) / 7700).toFixed(2);
        const monthly = (weekly * 4).toFixed(2);
        const tr = document.createElement('tr');
        // é«˜äº®æ¸›è„‚å®‰å…¨å€é–“ï¼šæ­£å€¼ 300~700ï¼›é«˜äº®å¢è‚Œå®‰å…¨å€é–“ï¼šè² å€¼ -100~-300
        if (val > 0 && val >= 300 && val <= 700) {
          tr.classList.add('safe-fat');
        }
        if (val < 0 && val <= -100 && val >= -300) {
          tr.classList.add('safe-gain');
        }
        const sign = val > 0 ? '-' : '+';
        const displayVal = val > 0 ? `-${val}` : `+${Math.abs(val)}`;
        tr.innerHTML = `
          <td>${displayVal}</td>
          <td>${sign}${weekly}</td>
          <td>${sign}${monthly}</td>`;
        tbody.appendChild(tr);
      });
    };

    /*
      æ›´æ–°æ»‘æ¡¿èƒŒå¾Œçš„å®‰å…¨å€é¡¯ç¤ºæ¢ä»¥åŠæ¨è–¦æ–‡å­—ã€‚
      æ ¹æ“šç›®æ¨™é¡å‹ (æ¸›è„‚æˆ–å¢è‚Œ) è¨­å®šä¸åŒçš„å®‰å…¨å€æ®µèˆ‡é¡è‰²ã€‚
    */
    function updateSafeBar(goalType) {
      const rangeEl = document.getElementById('deficitRange');
      const safeBar = document.getElementById('safeBar');
      const safeText = document.getElementById('safeRangeText');
      const min = parseFloat(rangeEl.min);
      const max = parseFloat(rangeEl.max);
      let safeMin, safeMax, colorVar, text;
      if (goalType === 'gain') {
        safeMin = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-min-gain'));
        safeMax = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-max-gain'));
        colorVar = getComputedStyle(document.documentElement).getPropertyValue('--safe-color-gain');
        // ä½¿ç”¨æ˜Ÿè™Ÿç¬¦è™Ÿçªå‡ºæ¨è–¦ç¯„åœï¼Œå¢è‚Œæ¨è–¦100â€“300 kcal
        text = 'â­ï¸ æ¨è–¦å¢è‚Œç†±é‡ç¯„åœï¼š100â€“300 kcal (ç›ˆé¤˜)';
      } else {
        safeMin = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-min-fat'));
        safeMax = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--safe-max-fat'));
        colorVar = getComputedStyle(document.documentElement).getPropertyValue('--safe-color-fat');
        text = 'â­ï¸ æ¨è–¦æ¸›è„‚ç†±é‡ç¯„åœï¼š300â€“700 kcal (èµ¤å­—)';
      }
      const total = max - min;
      const left = (safeMin - min) / total * 100;
      const width = (safeMax - safeMin) / total * 100;
      safeBar.style.left = `${left}%`;
      safeBar.style.width = `${width}%`;
      safeBar.style.background = colorVar.trim();
      safeText.textContent = text;
      // æ ¹æ“šç›®æ¨™é¡å‹èª¿æ•´èƒŒæ™¯é¡è‰²ï¼Œæä¾›æ·¡è‰²èƒŒæ™¯ä½œç‚ºæ¨è–¦æç¤º
      if (goalType === 'gain') {
        safeText.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--safe-color-gain').trim();
      } else {
        safeText.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--safe-color-fat').trim();
      }
    }

    /*
      æ ¹æ“šç•¶å‰è¨ˆç®—çµæœç”¢ç”Ÿçµæœå¡åœ–ç‰‡ä¸¦è³¦å€¼æ–¼ä¸‹è¼‰é€£çµã€‚
      å¡ç‰‡åŒ…å«åŸºæœ¬æ•¸æ“šã€è¡¨æ ¼å’Œè¡Œå‹•æŒ‡ä»¤ã€‚
    */
    function generateResultCard() {
      if (!computedResults || !computedResults.tdee) return;
      const {
        bmr,
        tdee,
        targetKcal,
        diffVal,
        weeklyChangeVal,
        monthlyChangeVal,
        weeks,
        monthsToReach,
        goalType
      } = computedResults;
      // Prepare canvas
      const canvas = document.createElement('canvas');
      const width = 1080;
      const height = 1920;
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      // Brand colour palette: warm orange and beige tones used across the BeBetter product.
      // These colours echo the primary UI theme from the calculator: coral oranges and warm browns.
      const darkBg = '#fffaf5';            // overall light beige background for the card
      const panelColor = '#fff3eb';        // slightly deeper beige for panels
      const borderColor = '#ead8cb';       // light brown for borders and separators
      const textColor = '#4b3e35';         // dark warm brown for general text
      const accentNeutral = '#d0502a';     // primary coral accent for titles and metrics
      const accentNeg = '#d0502a';         // same coral accent for deficit values
      const accentPos = '#dd6726';         // secondary warm orange for surplus values (unused for fat_loss)
      // Goal-based title and accent colour
      let titleText;
      if (goalType === 'gain') {
        titleText = 'BeBetter å¢è‚Œçµæœå¡';
      } else if (goalType === 'maintain') {
        titleText = 'BeBetter ç¶­æŒçµæœå¡';
      } else {
        titleText = 'BeBetter æ¸›è„‚çµæœå¡';
      }
      // Use golden accent for titles and icons
      const accent = accentNeutral;
      // Fill entire background
      ctx.fillStyle = darkBg;
      ctx.fillRect(0, 0, width, height);
      // Draw page title centered at top
      ctx.fillStyle = accent;
      ctx.font = 'bold 62px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText(titleText, width / 2, 90);
      // Compute sign and colours for current settings
      const signForVal = diffVal >= 0 ? '-' : '+';
      const valColor = diffVal >= 0 ? accentNeg : accentPos;
      // Determine goal label
      const goalLabel = goalType === 'gain' ? 'å¢è‚Œç†±é‡' : goalType === 'maintain' ? 'ç¶­æŒç†±é‡' : 'æ¸›è„‚ç†±é‡';
      // Draw top metrics row (3 items): BMR, Target, TDEE
      const topY = 150;
      const topH = 260; // å¢åŠ é«˜åº¦æä¾›æ›´å¤§é–“è·
      const topX = 60;
      const topW = width - 120;
      // Panel background
      ctx.fillStyle = panelColor;
      ctx.fillRect(topX, topY, topW, topH);
      const cols1 = 3;
      const cellW1 = topW / cols1;
      const metrics1 = [
        { label: 'BMR', value: Math.round(bmr) + ' kcal', color: accentNeutral },
        { label: goalLabel, value: Math.round(targetKcal) + ' kcal', color: accentNeutral },
        { label: 'TDEE', value: Math.round(tdee) + ' kcal', color: accentNeutral }
      ];
      metrics1.forEach((item, i) => {
        const cx = topX + i * cellW1;
        // optional vertical divider
        if (i > 0) {
          ctx.strokeStyle = borderColor;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(cx, topY + 20);
          ctx.lineTo(cx, topY + topH - 20);
          ctx.stroke();
        }
        // draw label
        ctx.fillStyle = textColor;
        ctx.font = '26px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(item.label, cx + cellW1 / 2, topY + 65);
        // draw value with accent colour. ä½¿ç”¨è¼ƒå°å­—é«”ä¸¦ç½®ä¸­ï¼Œé¿å…ç›¸é„°å¡ç‰‡æ–‡å­—æ“æ“ 
        ctx.fillStyle = item.color;
        ctx.font = 'bold 60px sans-serif';
        ctx.fillText(item.value, cx + cellW1 / 2, topY + 160);
      });
      // Draw second metrics rows (4 items in 2x2 grid)
      const secondY = topY + topH + 40;
      const rowH = 220;
      const colW2 = (topW / 2);
      const metrics2 = [
        { label: 'æ¯é€±è®ŠåŒ–', value: signForVal + Math.abs(weeklyChangeVal).toFixed(2) + ' kg', color: accentNeutral },
        { label: 'æ¯æœˆè®ŠåŒ–', value: signForVal + Math.abs(monthlyChangeVal).toFixed(2) + ' kg', color: accentNeutral },
        { label: 'é”æˆé€±æ•¸', value: (weeks === '--' ? '--' : weeks) + ' é€±', color: accentNeutral },
        { label: 'é”æˆæœˆæ•¸', value: (monthsToReach === '--' ? '--' : monthsToReach) + ' æœˆ', color: accentNeutral }
      ];
      // Panel background for second rows
      ctx.fillStyle = panelColor;
      ctx.fillRect(topX, secondY, topW, rowH * 2);
      metrics2.forEach((item, idx) => {
        const row = Math.floor(idx / 2);
        const col = idx % 2;
        const cx = topX + col * colW2;
        const cy = secondY + row * rowH;
        // vertical divider lines
        if (col === 1) {
          ctx.strokeStyle = borderColor;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(cx, cy + 20);
          ctx.lineTo(cx, cy + rowH - 20);
          ctx.stroke();
        }
        // horizontal divider line
        if (row === 1 && col === 0) {
          ctx.strokeStyle = borderColor;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(topX + 10, cy);
          ctx.lineTo(topX + topW - 10, cy);
          ctx.stroke();
        }
        // draw label
        ctx.fillStyle = textColor;
        ctx.font = '22px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(item.label, cx + colW2 / 2, cy + 60);
        // draw value
        ctx.fillStyle = item.color;
        ctx.font = 'bold 48px sans-serif';
        ctx.fillText(item.value, cx + colW2 / 2, cy + 135);
      });
      // Draw bar chart area
      // Determine starting Y position for chart section: leave breathing space after metrics rows
      const chartYStart = secondY + rowH * 2 + 60;
      // Height for legacy usage (unused in new unified bar chart), kept for compatibility
      const chartH = 420;
      const chartW = topW;
      const chartX = topX;
      // Chart panel background
      ctx.fillStyle = panelColor;
      ctx.fillRect(chartX, chartYStart, chartW, chartH + 130);
      // Chart title
      ctx.fillStyle = accentNeutral;
      ctx.font = 'bold 32px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('æ¨è–¦å·®å€¼ vs æ¯é€±è®ŠåŒ–', chartX + chartW / 2, chartYStart + 60);
      // Determine recommended differences for chart
      let recDiffs;
      if (goalType === 'gain') {
        recDiffs = [100, 200, 300];
      } else if (goalType === 'maintain') {
        recDiffs = [0];
      } else {
        recDiffs = [300, 500, 700];
      }
      // Compute weekly change values (kg) for each recommended difference
      const recChanges = recDiffs.map(v => {
        const changeVal = (v * 7) / 7700;
        return goalType === 'gain' ? changeVal : -changeVal;
      });
      // Use absolute values for bar heights to show magnitude of change
      const recAbsChanges = recChanges.map(c => Math.abs(c));
      const maxAbs = Math.max(...recAbsChanges);
      // Chart layout: bars anchored at the bottom of bar area (unified orientation)
      const barAreaHeight = 300;
      const barPanelHeight = barAreaHeight + 140; // include space for labels above and below
      // Draw chart panel background
      ctx.fillStyle = panelColor;
      ctx.fillRect(chartX, chartYStart + 80, chartW, barPanelHeight);
      // Draw bars
      const barCount = recDiffs.length;
      const barSpacing = 80;
      const barWidth = (chartW - 80 - barSpacing * (barCount - 1)) / barCount;
      const barBaseY = chartYStart + 80 + barAreaHeight;
      recDiffs.forEach((diff, i) => {
        const change = recChanges[i];
        const absChange = recAbsChanges[i];
        const barHeight = maxAbs > 0 ? absChange / maxAbs * (barAreaHeight - 60) : 0;
        const bx = chartX + 40 + i * (barWidth + barSpacing);
        // Determine bar colour: use coral for deficits and a lighter orange for surpluses
        let barColor;
        if (change < 0) {
          barColor = accentNeutral;
        } else if (change > 0) {
          // lighter shade for potential surplus bars
          barColor = '#f2b06a';
        } else {
          barColor = accentNeutral;
        }
        ctx.fillStyle = barColor;
        ctx.fillRect(bx, barBaseY - barHeight, barWidth, barHeight);
        // Outline the bar
        ctx.strokeStyle = borderColor;
        ctx.lineWidth = 1;
        ctx.strokeRect(bx, barBaseY - barHeight, barWidth, barHeight);
        // Draw weekly change label above bar with units (kg)
        ctx.fillStyle = accentNeutral;
        ctx.font = 'bold 26px sans-serif';
        ctx.textAlign = 'center';
        const weeklyLabel = (change < 0 ? '-' : change > 0 ? '+' : '') + absChange.toFixed(2) + ' kg';
        ctx.fillText(weeklyLabel, bx + barWidth / 2, barBaseY - barHeight - 12);
        // Draw diff label below bar with units (kcal); note: positive diff values represent deficits
        ctx.font = 'bold 26px sans-serif';
        const diffLabel = diff > 0 ? '-' + diff + ' kcal' : diff < 0 ? '+' + Math.abs(diff) + ' kcal' : '0 kcal';
        ctx.fillText(diffLabel, bx + barWidth / 2, barBaseY + 40);
      });
      // Axis labels: horizontal axis label below chart
      ctx.fillStyle = accentNeutral;
      ctx.font = 'bold 24px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('æ¯æ—¥å·®å€¼ (kcal)', chartX + chartW / 2, chartYStart + 80 + barPanelHeight + 40);
      // Determine the end position of the chart section to place action panel below it
      // chartPanelTop and barPanelHeight were defined earlier when drawing the bar chart
      const chartPanelTop = chartYStart + 80;
      const chartPanelBottom = chartPanelTop + barPanelHeight;
      const axisLabelOffset = 50; // space for axis label and padding
      const actionY = chartPanelBottom + axisLabelOffset;
      const actionH = 550;
      // Draw call-to-action panel
      ctx.fillStyle = panelColor;
      ctx.fillRect(topX, actionY, topW, actionH);
      // Section header: highlight with golden accent
      ctx.fillStyle = accent;
      ctx.font = 'bold 42px sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText('ä½ çš„ä¸‹ä¸€æ­¥', topX + 20, actionY + 65);
      // List of action items with icons and text
      const actions = [
        { icon: 'âœ…', text: 'ä»Šå¤©ï¼šåˆ° MFP è¨­å®šä½ çš„' + (goalType === 'gain' ? 'å¢è‚Œç†±é‡' : goalType === 'maintain' ? 'ç¶­æŒç†±é‡' : 'æ¸›è„‚ç†±é‡') + 'ï¼ŒæŒ‰èª²ç¨‹ W6 è¨­è¨ˆä¸‰å¤§ç‡Ÿé¤Šç´ ' },
        { icon: 'ğŸ“Š', text: 'æœ¬é€±ç›®æ¨™ï¼šæ¯å¤©ç©ºè…¹é‡é«”é‡ã€é«”æ…‹ç…§ã€ç´€éŒ„é£²é£Ÿ' },
        { icon: 'ğŸš€', text: 'æ›´å¤šå…§å®¹ï¼šå¯ä»¥åˆ° BeBetter æˆé•·å­¸é™¢è§€çœ‹' },
        { icon: 'ğŸ”', text: 'å¦‚ä½•åŠ å…¥/ç™»å…¥ï¼šSkool æœå°‹ã€ŒBeBetter æˆé•·å­¸é™¢ã€' }
      ];
      // Starting Y position for first action line; leave more space after the section title
      let actionYPos = actionY + 140;
      actions.forEach(item => {
        // Draw icon
        ctx.fillStyle = accent;
        ctx.font = 'bold 36px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText(item.icon, topX + 20, actionYPos);
        // Draw text; wrap if necessary at a fixed width
        ctx.fillStyle = textColor;
        ctx.font = '26px sans-serif';
        const startX = topX + 80;
        const maxTextWidth = topW - 100;
        // Function to draw wrapped text
        function drawWrappedText(text, x, y, maxWidth, lineHeight) {
          const words = text.split(/\s+/);
          let line = '';
          let lineY = y;
          words.forEach((word, idx) => {
            const testLine = line + (line ? ' ' : '') + word;
            if (ctx.measureText(testLine).width > maxWidth) {
              ctx.fillText(line, x, lineY);
              line = word;
              lineY += lineHeight;
            } else {
              line = testLine;
            }
          });
          if (line) ctx.fillText(line, x, lineY);
          return lineY + lineHeight;
        }
        // Draw the wrapped text and update Y pos for next item
        actionYPos = drawWrappedText(item.text, startX, actionYPos, maxTextWidth, 36) + 20;
      });
      // Reminder lines at the bottom of the action panel
      ctx.fillStyle = '#888888';
      ctx.font = '24px sans-serif';
      let remind;
      if (goalType === 'gain') {
        remind = 'å»ºè­°æ¯æ—¥ç›ˆé¤˜ â‰¤300 kcalï¼Œé¿å…è„‚è‚ªç´¯ç©';
      } else if (goalType === 'maintain') {
        remind = 'ç¶­æŒç†±é‡å¹³è¡¡ï¼Œé¿å…æ”å–æ³¢å‹•éå¤§';
      } else {
        remind = 'å»ºè­°æ¯æ—¥èµ¤å­— â‰¤700 kcalï¼Œé¿å…ä»£è¬ä¸‹é™';
      }
      const remindersStartY = actionY + actionH - 80;
      ctx.fillText('âš ï¸ ' + remind, topX + 20, remindersStartY);
      ctx.fillText('ğŸ“Œ é«”é‡çŸ­æœŸå·®ç•°ä¾†è‡ªæ°´åˆ†ï¼Œè«‹ä»¥4é€±ç‚ºå–®ä½è§€å¯Ÿ', topX + 20, remindersStartY + 40);
      // Convert canvas to image and assign to download link
      const dataURL = canvas.toDataURL('image/png');
      const downloadLink = document.getElementById('downloadCardBtn');
      downloadLink.href = dataURL;
      downloadLink.download = 'result_card.png';
      return dataURL;
    }

    // é»æ“Šä¸‹è¼‰æŒ‰éˆ•ç”¢ç”Ÿä¸¦ä¸‹è¼‰çµæœå¡
    document.getElementById('downloadCardBtn').addEventListener('click', function(e) {
      e.preventDefault();
      const url = generateResultCard();
      // ç”Ÿæˆè‡¨æ™‚éˆçµä»¥å¼·åˆ¶è§¸ç™¼ä¸‹è¼‰
      const tmp = document.createElement('a');
      tmp.href = url;
      tmp.download = 'result_card.png';
      document.body.appendChild(tmp);
      tmp.click();
      tmp.remove();
    });

    // ä¸€å°ä¸€è«®è©¢æŒ‰éˆ•ï¼šé–‹å•Ÿè«®è©¢é é¢
    document.getElementById('consultBtn').addEventListener('click', function(e) {
      e.preventDefault();
      window.open('https://243112.typeform.com/to/skpdVy', '_blank');
    });

    // æ»‘é¼ è·Ÿéš¨åœ“åœˆæ•ˆæœ
    const cursorCircle = document.getElementById('cursorCircle');
    document.addEventListener('mousemove', (e) => {
      // å°‡åœ“å¿ƒæ”¾åœ¨æ»‘é¼ ä½ç½®ï¼Œå–å…ƒç´ å¯¦éš›å°ºå¯¸ä½¿åœ“ç’°åŒ…è¦†æŒ‡é‡
      const size = cursorCircle.offsetWidth || 50;
      const x = e.clientX - size / 2;
      const y = e.clientY - size / 2;
      cursorCircle.style.transform = `translate(${x}px, ${y}px)`;
    });

  </script>
</body>
</html>